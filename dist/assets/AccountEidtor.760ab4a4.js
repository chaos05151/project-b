import{_ as L,C as z,u as I,r as h,D as w,e as p,g as K,a as k,c as A,t as j,j as n,k as c,h as $,q as J,p as O,F as G,m as H,z as v,v as Q,N as W,l as S}from"./index.3fee5d13.js";import{f as X,h as Y,j as Z}from"./privilelge.a8609542.js";const ee={class:"crumbs"},te=v("\u6743\u9650\u7BA1\u7406"),ae=v("\u6DFB\u52A0\u8D26\u53F7"),re={class:"container"},le=v("\u53D6\u6D88"),oe=v("\u4FDD\u5B58"),ne={__name:"AccountEidtor",setup(se){const y=z(),u=I(),C=h(!0),V=h(!0),o=w({username:"",nickname:"",admin_role_id:"",main_product_id:"",product_id:""}),E=h([]);h([]);const f=h(),R=()=>{Y().then(r=>{r.status==200&&(console.log(r),V.value=!1,E.value=r.data.products.map(t=>({value:t.id,label:t.main_product_name,children:t.children.map(a=>({value:a.id,label:a.product_name}))})),q())}).catch(r=>{console.log(r)})},q=()=>{console.time("time");let r=JSON.parse(JSON.stringify(E.value));console.log(u.privilegeaccount),o.username=u.privilegeaccount.username,o.nickname=u.privilegeaccount.nickname,o.admin_role_id=u.privilegeaccount.admin_role_id,o.main_product_id=u.privilegeaccount.main_product_id,o.product_id=u.privilegeaccount.product_id;const t=u.privilegeaccount.main_product_id.split(","),a=u.privilegeaccount.product_id.split(",");let l=[];r.forEach(e=>{t.includes(String(e.value))&&l.push(e)});let m=l.map(e=>e.value);console.log(m);let s=[];l.forEach(e=>{e.children.forEach(g=>{a.includes(String(g.value))&&s.push(e.value)})}),s=Array.from(new Set(s));let d=[];m.forEach(e=>{s.includes(e)||d.push(e)}),d=Array.from(new Set(d)),console.log(l,d);let _=[];l.forEach(e=>{d.forEach(g=>{e.value==g&&e.children.forEach(b=>{_.push(b.value)})})}),console.log(_),console.log(s),l.forEach(e=>{e.children.forEach(g=>{a.includes(String(g.value))})});const N=t.concat(a);W(()=>{N.forEach(e=>{f.value.setChecked(Number(e),!0,!1)}),_.forEach(e=>{f.value.setChecked(e,!0,!1)})}),console.timeEnd("time")},x=h(),T=w({username:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u586B\u5199\u5BC6\u7801",trigger:"blur"}],nickname:[{required:!0,message:"\u8BF7\u8F93\u5165\u6635\u79F0",trigger:"blur"}],admin_role_id:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272",trigger:"change"}],productTree:[{required:!0,validator:(r,t,a)=>{let l=f.value.getCheckedKeys(!1,!0);l.length==0||!l?a(new Error("\u8BF7\u9009\u62E9\u529F\u80FD\u6743\u9650\u8BBE\u7F6E")):a()},trigger:"change"}]}),D=h([]),B=(r,t)=>{console.log(f.value.getCheckedNodes(!1,!0));let a=JSON.parse(JSON.stringify(f.value.getCheckedNodes(!1,!0))),l=[],m=[];a.forEach(_=>{_.children?l.push(_.value):m.push(_.value)});const s=l.join(","),d=m.join(",");o.main_product_id=s,o.product_id=d},F=()=>{X().then(r=>{r.status==200&&(C.value=!1,r.data.lists,console.log(r.data.lists),D.value=r.data.lists,R())})},P=(r,t)=>{Z(r,t).then(a=>{a.status==200?(S.success("\u7F16\u8F91\u6210\u529F"),y.push({name:"privilegelist"})):S.error("\u7F16\u8F91\u5931\u8D25,"+a.message)}).catch(a=>{S.error("\u7F16\u8F91\u5931\u8D25"+a)})},U=()=>{y.go(-1)},M=r=>{r.validate((t,a)=>{if(t){JSON.parse(JSON.stringify(f.value.getCheckedNodes(!1,!0)));let l=JSON.parse(JSON.stringify(o));console.log(l),P(u.privilegeaccount.id,l)}else console.log("error submit!",a)})};return F(),(r,t)=>{const a=p("el-breadcrumb-item"),l=p("el-breadcrumb"),m=p("el-input"),s=p("el-form-item"),d=p("el-radio"),_=p("el-radio-group"),N=p("el-tree"),e=p("el-button"),g=p("el-form"),b=K("loading");return k(),A("div",null,[j("div",ee,[n(l,{separator:"/"},{default:c(()=>[n(a,null,{default:c(()=>[te]),_:1}),n(a,null,{default:c(()=>[ae]),_:1})]),_:1})]),j("div",re,[n(g,{model:o,"label-width":"100px",style:{width:"400px"},"status-icon":"",ref_key:"ruleFormRef",ref:x,rules:T},{default:c(()=>[n(s,{prop:"username",label:"\u7528\u6237\u540D"},{default:c(()=>[n(m,{modelValue:o.username,"onUpdate:modelValue":t[0]||(t[0]=i=>o.username=i),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",clearable:""},null,8,["modelValue"])]),_:1}),n(s,{prop:"nickname",label:"\u6635\u79F0"},{default:c(()=>[n(m,{modelValue:o.nickname,"onUpdate:modelValue":t[1]||(t[1]=i=>o.nickname=i),placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",clearable:""},null,8,["modelValue"])]),_:1}),n(s,{prop:"admin_role_id",label:"\u89D2\u8272"},{default:c(()=>[$(' <el-checkbox v-model="checkAll" :indeterminate="isIndeterminate" @change="handleAllChange">\u5168\u9009</el-checkbox> '),J((k(),O(_,{modelValue:o.admin_role_id,"onUpdate:modelValue":t[2]||(t[2]=i=>o.admin_role_id=i)},{default:c(()=>[(k(!0),A(G,null,H(D.value,i=>(k(),O(d,{key:i.id,label:i.id},{default:c(()=>[v(Q(i.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])),[[b,C.value]])]),_:1}),n(s,{prop:"productTree",label:"\u5E94\u7528"},{default:c(()=>[J(n(N,{ref_key:"treeRef",ref:f,data:E.value,multiple:"","show-checkbox":"","node-key":"value",onCheck:B},null,8,["data"]),[[b,V.value]])]),_:1}),n(s,null,{default:c(()=>[n(e,{onClick:U},{default:c(()=>[le]),_:1}),n(e,{type:"primary",onClick:t[3]||(t[3]=i=>M(x.value))},{default:c(()=>[oe]),_:1})]),_:1})]),_:1},8,["model","rules"])])])}}},de=L(ne,[["__file","/Users/apple/Desktop/project-b/relationship.b/src/views/privilegeManagement/AccountEidtor.vue"]]);export{de as default};
