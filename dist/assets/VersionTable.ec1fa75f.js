import{_ as F,g as v,f as I,l as R,E as _,r as s,o as i,H as k,w as n,a as C,b as e,c as M,I as z,F as A,O as S,e as V,G as E,D as J,L as K}from"./index.03d21809.js";import{i as q,j as Q,k as W,l as X}from"./product.56b44d03.js";import{h as B}from"./moment.9709ab41.js";import{s as T}from"./showButton.004c7379.js";import"./request.b7a5dcc4.js";const Z={class:"dialog-footer"},ee=V("\u53D6 \u6D88"),ae=V("\u786E \u5B9A"),le={__name:"addversiontable",props:{addVisible:{default:!1}},emits:["update-add","update-addVisible"],setup(L,{emit:D}){const g=c=>c?/^([0-9]\d|[0-9])(.([0-9]\d|\d)){2}$/.test(c)?!0:(_.error("\u7248\u672C\u53F7\u683C\u5F0F\u4E3A\u6570\u5B57\u5982:x.x.x"),!1):(_.error("\u8BF7\u9009\u62E9\u6E38\u620F\uFF01"),!1),w=v([]),a=I({}),u=v([]),p=v(""),Y=async()=>{if(D("update-addVisible",!1),a.add_uptime&&a.add_uptime<B().format("YYYY-MM-DD HH:mm:ss")){_.error("\u9884\u671F\u4E0A\u7EBF\u65F6\u95F4\u4E0D\u80FD\u5728\u5F53\u524D\u65F6\u95F4\u4E4B\u524D\uFF01");return}if(!g(a.add_versions_b)||!g(a.add_versions_c))return;const c={product_id:a.add_product_name_selected,channel:a.add_channel_name_selected,versions_b:a.add_versions_b,versions_c:a.add_versions_c,uptime:a.add_uptime?a.add_uptime:B().format("YYYY-MM-DD HH:mm:ss")};await Q(c),_.success("\u65B0\u589E\u6210\u529F"),D("update-add")};R(()=>{m()});const m=async()=>{try{const c=await q();u.value=c.data.games,w.value=c.data.channels}catch(c){console.log(c),_.error("\u670D\u52A1\u5668\u5F02\u5E38\uFF01")}},x=()=>{D("update-add")};return(c,l)=>{const H=s("el-option"),f=s("el-select"),h=s("el-form-item"),U=s("el-input"),$=s("el-date-picker"),t=s("el-form"),d=s("el-button"),b=s("el-dialog");return i(),k(b,{title:"\u65B0\u589E\u7248\u672C",width:"60%",modelValue:L.addVisible,"onUpdate:modelValue":l[5]||(l[5]=o=>S(addVisible)?addVisible.value=o:null),onClose:x},{footer:n(()=>[C("span",Z,[e(d,{onClick:x},{default:n(()=>[ee]),_:1}),e(d,{type:"primary",onClick:Y},{default:n(()=>[ae]),_:1})])]),default:n(()=>[e(t,{"label-width":"110px"},{default:n(()=>[e(h,{label:"\u6E38\u620F\u9009\u62E9"},{default:n(()=>[e(f,{style:{width:"18%"},modelValue:a.add_product_name_selected,"onUpdate:modelValue":l[0]||(l[0]=o=>a.add_product_name_selected=o),placeholder:"\u6E38\u620F\u9009\u62E9",class:"m-2"},{default:n(()=>[(i(!0),M(A,null,z(u.value,o=>(i(),k(H,{key:o.value,label:o.label_name,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"\u6E20\u9053\u9009\u62E9"},{default:n(()=>[e(f,{ref_key:"add_channel_name_selected_label",ref:p,style:{width:"18%"},modelValue:a.add_channel_name_selected,"onUpdate:modelValue":l[1]||(l[1]=o=>a.add_channel_name_selected=o),placeholder:"\u6E38\u620F\u9009\u62E9",class:"m-2"},{default:n(()=>[(i(!0),M(A,null,z(w.value,o=>(i(),k(H,{key:o.value,label:o.label_name,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"\u540E\u53F0\u7248\u672C"},{default:n(()=>[e(U,{style:{width:"160px"},modelValue:a.add_versions_b,"onUpdate:modelValue":l[2]||(l[2]=o=>a.add_versions_b=o)},null,8,["modelValue"])]),_:1}),e(h,{label:"\u524D\u7AEF\u7248\u672C"},{default:n(()=>[e(U,{style:{width:"160px"},modelValue:a.add_versions_c,"onUpdate:modelValue":l[3]||(l[3]=o=>a.add_versions_c=o)},null,8,["modelValue"])]),_:1}),e(h,{label:"\u9884\u671F\u4E0A\u7EBF\u65F6\u95F4",prop:"uptime"},{default:n(()=>[e($,{modelValue:a.add_uptime,"onUpdate:modelValue":l[4]||(l[4]=o=>a.add_uptime=o),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},te=F(le,[["__file","/Users/apple/Desktop/project-b github/project-b/src/componentsadds/addversiontable.vue"]]);const oe={class:"crumbs"},ne=V("\u98CE\u63A7\u7CFB\u7EDF"),se=V("\u7248\u672C\u7BA1\u7406"),de={class:"container"},re={class:"handle-box"},ue=V("\xA0\xA0 "),ce=V("\u65B0\u589E\u7248\u672C"),_e=V("\u5220\u9664 "),ie={class:"pagination"},pe={__name:"VersionTable",setup(L){T("product:version:view");const D=T("product:version:add");T("product:version:edit"),T("product:version:del");const g=v(!1),w=v([]),a=v([]),u=v(""),p=v(""),Y=v([]),m=I({page_index:1,page_size:10}),x=v(0),c=()=>{f()},l=async t=>{try{const d=await W(t);d.status==200&&(a.value=await d.data.lists.map(b=>({...b,created_at:B(b.created_at).format("YYYY-MM-DD HH:mm:ss"),uptime:B(b.uptime).format("YYYY-MM-DD HH:mm:ss")})),x.value=d.data.total_count)}catch{_.error("\u670D\u52A1\u5668\u5F02\u5E38\uFF01")}g.value=!1},H=async()=>{try{const t=await q();t.status==200?(Y.value=t.data.games,u.value=Y.value[0].value,w.value=t.data.channels):t.message?_.error(t.message):_.error("\u540E\u7AEFapi\u63A5\u53E3\u5F02\u5E38\uFF01")}catch{_.error("\u670D\u52A1\u5668\u5F02\u5E38\uFF01")}f()},f=()=>{if(u.value==-1&&p.value==-1)l(m);else if(u.value==-1&&p.value!=-1){const t={channel:p.value,...m};l(t)}else if(u.value!=-1&&p.value==-1){const t={product_id:u.value,...m};l(t)}else if(u.value||p.value){const t={product_id:u.value,channel:p.value,...m};l(t)}else l(m)},h=async t=>{try{await K.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{type:"warning"}),await X(t),_.success("\u5220\u9664\u7248\u672C\u6210\u529F"),await l()}catch{_.error("\u8BF7\u91CD\u8BD5")}},U=t=>{m.page_index=t,f()},$=()=>{g.value=!0};return l(),H(),(t,d)=>{const b=s("el-breadcrumb-item"),o=s("el-breadcrumb"),j=s("el-option"),N=s("el-select"),P=s("el-button"),y=s("el-table-column"),G=s("el-table"),O=s("el-pagination");return i(),M("div",null,[C("div",oe,[e(o,{separator:"/"},{default:n(()=>[e(b,null,{default:n(()=>[ne]),_:1}),e(b,null,{default:n(()=>[se]),_:1})]),_:1})]),C("div",de,[C("div",re,[e(N,{modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=r=>u.value=r),placeholder:"\u6E38\u620F\u9009\u62E9",class:"m-2",onChange:c},{default:n(()=>[(i(!0),M(A,null,z(Y.value,r=>(i(),k(j,{key:r.value,label:r.label_name,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(N,{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=r=>p.value=r),placeholder:"\u6E20\u9053\u9009\u62E9",class:"m-2",onChange:f},{default:n(()=>[e(j,{label:"\u5168\u90E8",value:"-1"}),(i(!0),M(A,null,z(w.value,r=>(i(),k(j,{key:r.value,label:r.label_name,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),ue,E(' <el-button type="primary" icon="el-icon-search" @click="handleSearch">\u641C\u7D22</el-button> '),J(D)?(i(),k(P,{key:0,type:"primary",onClick:$},{default:n(()=>[ce]),_:1})):E("v-if",!0)]),e(G,{data:a.value,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:n(()=>[e(y,{prop:"channel_name",label:"\u6E20\u9053\u4FE1\u606F"}),e(y,{prop:"versions_b",label:"\u540E\u7AEF\u7248\u672C"}),e(y,{prop:"created_at",label:"\u521B\u5EFA\u65F6\u95F4"}),e(y,{prop:"versions_c",label:"\u524D\u7AEF\u6700\u65B0\u7248\u672C"}),e(y,{prop:"uptime",label:"\u9884\u671F\u4E0A\u7EBF\u65F6\u95F4"}),e(y,{label:"\u64CD\u4F5C"},{default:n(r=>[e(P,{size:"small",type:"danger",onClick:me=>h(r.row.id)},{default:n(()=>[_e]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),C("div",ie,[e(O,{background:"",layout:"total, prev, pager, next","current-page":m.page_index,"page-size":m.page_size,total:x.value,onCurrentChange:U},null,8,["current-page","page-size","total"])])]),e(te,{addVisible:g.value,onUpdateAdd:l},null,8,["addVisible"])])}}},ge=F(pe,[["__scopeId","data-v-c078e7e0"],["__file","/Users/apple/Desktop/project-b github/project-b/src/views/VersionTable.vue"]]);export{ge as default};
